<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Learn With JBKriyansh</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    input, button { margin: 10px; padding: 10px; width: 80%; max-width: 400px; }
    .btn { border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
    .green { background: #00c853; color: white; }
    .blue { background: #2196f3; color: white; }
    .purple { background: #7e57c2; color: white; }
    .red { background: #e53935; color: white; }
    #output { margin-top: 20px; word-break: break-all; }
  </style>
</head>
<body>
  <h2>LEARN WITH JBKRIYANSH</h2>
  <p><b>Enter RareStudy URL</b></p>
  <input id="inputUrl" type="text" placeholder="https://rarestudy.site/media/..."/>
  <br>
  <button class="btn green" onclick="startFlow()">Generate</button>
  <button class="btn blue" onclick="copyOutput()">Copy</button>
  <button class="btn purple" onclick="location.reload()">Refresh</button>
  
  <div id="output"></div>

<script>
async function startFlow() {
  let url = document.getElementById("inputUrl").value.trim();
  if (!url) { alert("Please enter RareStudy URL"); return; }
  
  document.getElementById("output").innerHTML = "⏳ Processing... Please wait...";

  try {
    // Step 1: Store RareStudy URL
    localStorage.setItem("rarestudy_video_url", url);

    // Step 2: Simulate Sniffer (bookmark.html)
    let captured = simulateSniffer(url);
    localStorage.setItem("bookmark_captured_urls", JSON.stringify(captured));

    // Step 3: CutCDN (pick first link)
    let cutLink = captured[0];
    localStorage.setItem("cutcdn_selected_url", cutLink);

    // Step 4: Convert to m3u8
    let m3u8Link = cutLink.replace(".mp4", ".m3u8"); // simple convert
    localStorage.setItem("m3u8_converted_url", m3u8Link);

    // Step 5: Final Render Link
    let renderLink = "https://player.example.com/?src=" + encodeURIComponent(m3u8Link);
    localStorage.setItem("render_final_url", renderLink);

    document.getElementById("output").innerHTML = 
      `<p>✅ Done! Final Render Link:</p>
       <textarea id="finalLink" rows="3" style="width:90%">${renderLink}</textarea>`;
  } catch (e) {
    document.getElementById("output").innerHTML = "❌ Error: " + e.message;
  }
}

// Fake Sniffer Function (replace with your real capture logic)
function simulateSniffer(url) {
  return [
    url.replace("/media/", "/cdn/") + ".mp4",
    url.replace("/media/", "/backup/") + ".mp4"
  ];
}

function copyOutput() {
  let text = document.getElementById("finalLink");
  if (!text) return alert("No output yet!");
  text.select();
  document.execCommand("copy");
  alert("Copied!");
}
</script>
</body>
</html>
