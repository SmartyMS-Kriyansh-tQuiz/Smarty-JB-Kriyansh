<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>LEARN WITH JBKRIYANSH ‚Äî Dashboard</title>
<style>
body{font-family:Inter,system-ui,Arial,sans-serif;background:#f0f4f8;margin:0;padding:20px;display:flex;justify-content:center;align-items:center;min-height:100vh;}
.container{background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.15);padding:20px;max-width:420px;width:100%;text-align:center;}
h1{background:linear-gradient(90deg,#2563eb,#3b82f6);color:#fff;padding:12px;border-radius:8px;margin-bottom:20px;font-size:22px;}
input{width:100%;padding:12px;border-radius:6px;border:1px solid #ccc;margin-bottom:12px;font-size:16px;}
button{width:100%;padding:12px;border:none;border-radius:6px;color:#fff;font-weight:600;font-size:16px;margin:6px 0;cursor:pointer;transition:0.2s;}
button.generate{background:#10b981;}   /* Green */
button.copy{background:#14b8a6;}       /* Teal */
button.preview{background:#2563eb;}    /* Blue */
button.refresh{background:#8b5cf6;}    /* Purple */
button.back{background:#ef4444;}       /* Red */
button:hover{opacity:0.9;}
pre{background:#f1f5f9;padding:10px;border-radius:6px;margin-top:12px;overflow-x:auto;}
.note{font-size:13px;color:#555;margin-top:10px;}
</style>
</head>
<body>
<div class="container">
<h1>LEARN WITH JBKRIYANSH</h1>
<label>üé¨ Enter RareStudy Link</label>
<input type="text" id="rareUrl" placeholder="https://rarestudy.site/media/...">
<button class="generate" id="generateBtn">Save & Generate</button>
<button class="copy" id="copyBtn">Copy</button>
<button class="preview" id="previewBtn">Preview</button>
<button class="refresh" id="refreshBtn">Refresh</button>
<button class="back" id="backBtn">‚Üê Back</button>
<pre id="finalLink">‚Äî Final render link will appear here ‚Äî</pre>
<div class="note">‚ÑπÔ∏è Generating takes ~10s while render.html runs in background.</div>
</div>

<script>
const STORAGE_RARESTUDY = 'rarestudy_video_url';
const rareInput = document.getElementById('rareUrl');
const finalLinkEl = document.getElementById('finalLink');

// ---- SAVE + AUTO RUN RENDER ----
document.getElementById('generateBtn').addEventListener('click', async ()=>{
  const url = rareInput.value.trim();
  if(!url) return alert('Enter RareStudy URL first.');

  // Step 1: save RareStudy link
  localStorage.setItem(STORAGE_RARESTUDY, url);
  finalLinkEl.textContent = "‚öôÔ∏è Running render.html in background... Please wait 10s";

  // Step 2: open render.html in hidden iframe
  const iframe = document.createElement('iframe');
  iframe.src = "render.html";
  iframe.style.display = "none";
  document.body.appendChild(iframe);

  // Step 3: countdown popup
  let sec = 10;
  const countdown = setInterval(()=>{
    if(sec > 0){
      alert("‚è≥ Generating render link... " + sec + "s left");
      sec--;
    } else {
      clearInterval(countdown);
      // Step 4: after 10s fetch final link
      const finalUrl = localStorage.getItem('final_render_link');
      if(finalUrl){
        finalLinkEl.textContent = finalUrl;
        alert('‚úÖ Render link ready!');
      } else {
        finalLinkEl.textContent = "‚ùå Could not generate final render link. Try again.";
      }
      iframe.remove();
    }
  },1000);
});

// ---- COPY FINAL LINK ----
document.getElementById('copyBtn').addEventListener('click', ()=>{
  const text = finalLinkEl.textContent;
  if(!text.startsWith('http')) return alert('No render link to copy.');
  navigator.clipboard.writeText(text).then(()=>alert('üìã Copied render link!'));
});

// ---- PREVIEW FINAL LINK ----
document.getElementById('previewBtn').addEventListener('click', ()=>{
  const text = finalLinkEl.textContent;
  if(!text.startsWith('http')) return alert('No render link to preview.');
  window.open(text,'_blank');
});

// ---- REFRESH ----
document.getElementById('refreshBtn').addEventListener('click', ()=>location.reload());

// ---- BACK ----
document.getElementById('backBtn').addEventListener('click', ()=>window.history.back());

// ---- Keep input EMPTY on load ----
rareInput.value = "";
finalLinkEl.textContent = "‚Äî Final render link will appear here ‚Äî";
</script>
</body>
</html>
