<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Powerd By Smarty MS</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 28px; background:#f4f6f8; color:#222; }
    h1 { margin:0 0 18px; font-size:20px; background:linear-gradient(90deg,#0066ff,#0099ff); color:#fff; display:inline-block; padding:10px 18px; border-radius:8px; }
    .card { background:#fff; max-width:720px; margin:20px auto; padding:18px; border-radius:10px; box-shadow:0 6px 20px rgba(10,20,40,0.06); text-align:left; }
    label { display:block; font-weight:600; margin-bottom:6px; }
    textarea,input { width:100%; box-sizing:border-box; padding:10px 12px; border-radius:8px; border:1px solid #d7dbe0; font-size:14px; resize:vertical; }
    .row { display:flex; gap:10px; margin-top:12px; }
    .row button, .row a { flex:1; padding:12px; border-radius:8px; border:none; font-weight:700; cursor:pointer; text-decoration:none; color:#fff; text-align:center; }
    .generate { background:#0066ff; } /* blue */
    .copy { background:#00b894; } /* green */
    .preview { background:#0984e3; }
    .output { margin-top:14px; padding:10px; border-radius:8px; background:#f1f5f9; border:1px dashed #dbe7ff; word-break:break-all; }
    .note { font-size:13px; color:#555; margin-top:10px; }
    footer{ text-align:center; margin-top:16px; font-size:13px; color:#666; }
  </style>
</head>
<body>
  <h1>Powerd By Smarty MS</h1>

  <div class="card">
    <label for="inputUrl">CDN link will be auto-loaded from <code>cutcdn.html</code></label>
    <textarea id="inputUrl" rows="4" readonly>Loading CDN link from cutcdn.html...</textarea>

    <div class="row" style="margin-top:12px;">
      <button class="generate" id="btnGenerate">Generate Now</button>
      <button class="copy" id="btnCopy">Copy</button>
    </div>

    <div class="output" id="outputBox">Final link will appear here after generation.</div>

    <div style="margin-top:10px;">
      <a id="previewLink" class="preview" href="#" target="_blank" style="display:inline-block; padding:10px 14px; border-radius:8px; color:#fff;">Preview</a>
    </div>

    <div class="note">
      Notes: The tool auto-extracts the CDN link from <code>cutcdn.html</code>. If the file doesn’t contain a proper <code>master.mpd</code> or <code>master.m3u8</code> link, generation may fail.
    </div>
  </div>

  <footer>© LEARN WITH JBKRIYANSH</footer>

  <script>
    const btnGenerate = document.getElementById('btnGenerate');
    const btnCopy = document.getElementById('btnCopy');
    const inputEl = document.getElementById('inputUrl');
    const out = document.getElementById('outputBox');
    const preview = document.getElementById('previewLink');

    function makeFinalPlayerLink(m3u8) {
      return 'https://learnwithpw-recorded.onrender.com/play?v=' + encodeURIComponent(m3u8);
    }

    function replaceMpdToM3u8(u) {
      try {
        return u.replace(/master\.mpd/gi, 'master.m3u8');
      } catch(e) { return u; }
    }

    function extractSecProdUrlFromText(text) {
      if (!text) return null;
      const re = /(https?:\/\/sec-prod-mediacdn\.pw\.live\/[^\s"'<>]+)/i;
      const m = text.match(re);
      if (m && m[1]) return m[1];
      const re2 = /(https?:\/\/[^\s"'<>]*master\.(?:mpd|m3u8)[^\s"'<>]*)/i;
      const m2 = text.match(re2);
      if (m2 && m2[1]) return m2[1];
      return null;
    }

    async function loadCdnFromFile() {
      try {
        const resp = await fetch('cutcdn.html');
        if (!resp.ok) throw new Error('File not found');
        const txt = await resp.text();
        const cdn = extractSecProdUrlFromText(txt);
        if (cdn) {
          inputEl.value = cdn;
        } else {
          inputEl.value = '⚠️ No CDN link found inside cutcdn.html';
        }
      } catch (e) {
        inputEl.value = '❌ Error loading cutcdn.html';
      }
    }

    async function generate() {
      out.textContent = 'Working...';
      preview.href = '#';
      let val = inputEl.value.trim();
      if (!val || val.startsWith('⚠️') || val.startsWith('❌')) {
        alert('No valid CDN link loaded from cutcdn.html');
        out.textContent = 'No valid CDN link';
        return;
      }

      let candidate = extractSecProdUrlFromText(val);
      if (!candidate) candidate = val;
      const m3u8 = replaceMpdToM3u8(candidate);
      const final = makeFinalPlayerLink(m3u8);

      out.textContent = final;
      preview.href = final;
      preview.innerText = 'Preview';
      alert('Link Generated ✅');
    }

    btnGenerate.addEventListener('click', generate);

    btnCopy.addEventListener('click', async () => {
      const text = out.textContent && out.textContent.startsWith('http') ? out.textContent : '';
      if (!text) { alert('No generated link to copy. Click Generate Now first.'); return; }
      try {
        await navigator.clipboard.writeText(text);
        alert('Link copied ✅');
      } catch (e) {
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try { document.execCommand('copy'); alert('Link copied ✅'); } catch(err) { alert('Copy failed — select and copy manually.'); }
        ta.remove();
      }
    });

    inputEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        generate();
      }
    });

    // Auto-load CDN link from cutcdn.html on page load
    loadCdnFromFile();
  </script>
</body>
</html>
