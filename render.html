<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>LEARN WITH JBKRIYANSH ‚Äî RareStudy Media</title>
<style>
body{font-family:Inter,system-ui,Arial,sans-serif;background:#f0f4f8;margin:0;padding:20px;display:flex;justify-content:center;align-items:center;min-height:100vh;}
.container{background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.15);padding:20px;max-width:400px;width:100%;text-align:center;}
h1{background:linear-gradient(90deg,#2563eb,#3b82f6);color:#fff;padding:12px;border-radius:8px;margin-bottom:20px;font-size:22px;}
input{width:100%;padding:12px;border-radius:6px;border:1px solid #ccc;margin-bottom:12px;font-size:16px;}
button{width:100%;padding:12px;border:none;border-radius:6px;color:#fff;font-weight:600;font-size:16px;margin:6px 0;cursor:pointer;}
button.generate{background:#10b981;}
button.copy{background:#14b8a6;}
button.preview{background:#2563eb;}
button.refresh{background:#8b5cf6;}
button.back{background:#ef4444;}
pre{background:#f1f5f9;padding:10px;border-radius:6px;margin-top:12px;overflow-x:auto;}
</style>
</head>
<body>
<div class="container">
<h1>LEARN WITH JBKRIYANSH</h1>
<label>üé¨ RECORDED</label>
<input type="text" id="rareUrl" placeholder="https://rarestudy.site/media/...">
<button class="generate" id="generateBtn">Generate</button>
<button class="copy" id="copyBtn">Copy</button>
<button class="preview" id="previewBtn">Preview</button>
<button class="refresh" id="refreshBtn">Refresh</button>
<button class="back" id="backBtn">‚Üê Back</button>
<pre id="finalLink">‚Äî No final render link yet. Run full flow first.</pre>
</div>

<script>
// ---- STORAGE KEYS ----
const STORAGE_RARESTUDY = 'rarestudy_video_url';
const STORAGE_BOOKMARK = 'bookmark_captured_urls';
const STORAGE_CUTCDN = 'cutcdn_selected_url';
const STORAGE_M3U8 = 'm3u8_converted_url';
const STORAGE_FINAL = 'final_render_link';

const rareInput = document.getElementById('rareUrl');
const finalLinkEl = document.getElementById('finalLink');

// ---- GENERATE FLOW (Automated) ----
document.getElementById('generateBtn').addEventListener('click', ()=>{
  const url = rareInput.value.trim();
  if(!url) return alert('Enter RareStudy URL first.');

  // Step 1: Store raw RareStudy URL
  localStorage.setItem(STORAGE_RARESTUDY, url);

  // Step 2: Simulate bookmark.html ‚Üí capture media links
  // For simplicity, assume the URL itself is the first captured media
  const capturedUrls = [url];
  localStorage.setItem(STORAGE_BOOKMARK, JSON.stringify(capturedUrls));

  // Step 3: Simulate cutcdn.html ‚Üí pick last captured CDN
  const cutcdnUrl = capturedUrls[capturedUrls.length-1];
  localStorage.setItem(STORAGE_CUTCDN, cutcdnUrl);

  // Step 4: Simulate m3u8.html ‚Üí convert to master.m3u8
  let m3u8Url = cutcdnUrl
    .replace(/\/master\.mpd\?/gi,'/master.m3u8?')
    .replace(/\/dash\/720\/4\.mp4\?/gi,'/master.m3u8?')
    .replace(/\/dash\/audio\/4\.mp4\?/gi,'/master.m3u8?');
  localStorage.setItem(STORAGE_M3U8, m3u8Url);

  // Step 5: Simulate render.html ‚Üí generate final render link
  const renderLink = m3u8Url.includes('?') ? m3u8Url + '&rendered=true' : m3u8Url + '?rendered=true';
  localStorage.setItem(STORAGE_FINAL, renderLink);

  // Update UI
  finalLinkEl.textContent = renderLink;
  alert('‚úÖ Final render link ready!');
});

// ---- COPY FINAL LINK ----
document.getElementById('copyBtn').addEventListener('click', ()=>{
  const text = localStorage.getItem(STORAGE_FINAL);
  if(!text) return alert('No render link available.');
  navigator.clipboard.writeText(text).then(()=>alert('Copied render link!'));
});

// ---- PREVIEW FINAL LINK ----
document.getElementById('previewBtn').addEventListener('click', ()=>{
  const text = localStorage.getItem(STORAGE_FINAL);
  if(!text) return alert('No render link available.');
  window.open(text,'_blank');
});

// ---- REFRESH ----
document.getElementById('refreshBtn').addEventListener('click', ()=>location.reload());

// ---- BACK ----
document.getElementById('backBtn').addEventListener('click', ()=>window.history.back());

// ---- LOAD STORED URL IF ANY ----
const storedUrl = localStorage.getItem(STORAGE_RARESTUDY);
if(storedUrl) rareInput.value = storedUrl;

// ---- LOAD FINAL LINK IF EXISTS ----
const storedFinal = localStorage.getItem(STORAGE_FINAL);
if(storedFinal) finalLinkEl.textContent = storedFinal;
</script>
</body>
</html>
